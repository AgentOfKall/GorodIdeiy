{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–æ–≤—É—é –∏–¥–µ—é</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <strong>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:</strong>
                    <div class="mt-2">
                        <a href="{{ url_for('map_page', add_idea='true') }}" class="btn btn-outline-info btn-sm">
                            üó∫Ô∏è –î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
                        </a>
                        <span class="mx-2">–∏–ª–∏</span>
                        <button class="btn btn-outline-secondary btn-sm" disabled>
                            üìù –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –Ω–∏–∂–µ
                        </button>
                    </div>
                    <p class="mt-2 mb-0"><small>–°–æ–≤–µ—Ç: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—Ä—Ç—É –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è!</small></p>
                </div>
                
                <form method="POST" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="title" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∏–¥–µ–∏ *</label>
                        <input type="text" class="form-control" id="title" name="title" 
                               value="{{ request.form.get('title', '') }}" required
                               placeholder="–ö—Ä–∞—Ç–∫–æ–µ –∏ –ø–æ–Ω—è—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ *</label>
                        <textarea class="form-control" id="description" name="description" 
                                  rows="5" required placeholder="–û–ø–∏—à–∏—Ç–µ –¥–µ—Ç–∞–ª–∏ –≤–∞—à–µ–π –∏–¥–µ–∏">{{ request.form.get('description', '') }}</textarea>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="category" class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                            <select class="form-select" id="category" name="category" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                {% for category in categories %}
                                <option value="{{ category }}" 
                                        {% if request.form.get('category', '') == category %}selected{% endif %}>
                                    {{ category|title }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="city_id" class="form-label">–ì–æ—Ä–æ–¥</label>
                            <select class="form-select" id="city_id" name="city_id">
                                <option value="">–ù–µ —É–∫–∞–∑–∞–Ω</option>
                                {% for city in cities %}
                                <option value="{{ city.id }}" 
                                        {% if request.form.get('city_id', '')|int == city.id or default_city_id == city.id %}selected{% endif %}>
                                    {{ city.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="latitude" class="form-label">–®–∏—Ä–æ—Ç–∞ *</label>
                            <div class="input-group">
                                <input type="number" step="any" class="form-control" id="latitude" 
                                       name="latitude" value="{{ default_latitude or request.form.get('latitude', '') }}" required>
                                <button type="button" class="btn btn-outline-secondary" id="getLocationBtn">
                                    üìç
                                </button>
                            </div>
                            <div class="form-text">
                                <a href="{{ url_for('map_page', add_idea='true') }}" class="text-decoration-none">
                                    üó∫Ô∏è –ò–ª–∏ —É–∫–∞–∂–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ
                                </a>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="longitude" class="form-label">–î–æ–ª–≥–æ—Ç–∞ *</label>
                            <input type="number" step="any" class="form-control" id="longitude" 
                                   name="longitude" value="{{ default_longitude or request.form.get('longitude', '') }}" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="image" class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <input type="file" class="form-control" id="image" name="image" accept="image/*">
                        <div class="form-text">–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –∏–ª–∏ —Å—Ö–µ–º—É</div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('ideas_list') }}" class="btn btn-secondary me-md-2">–û—Ç–º–µ–Ω–∞</a>
                        <button type="submit" class="btn btn-success">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
document.getElementById('getLocationBtn').addEventListener('click', function() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function(position) {
                document.getElementById('latitude').value = position.coords.latitude.toFixed(6);
                document.getElementById('longitude').value = position.coords.longitude.toFixed(6);
                alert('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã!');
            },
            function(error) {
                let message = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ';
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        message += '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–∞–∑–∞–ª –≤ –¥–æ—Å—Ç—É–ø–µ';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        message += '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                        break;
                    case error.TIMEOUT:
                        message += '–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ';
                        break;
                    default:
                        message += '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                }
                alert(message);
            }
        );
    } else {
        alert('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º');
    }
});
</script>
{% endblock %}